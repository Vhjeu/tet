<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ChÃºc Táº¿t 2026 âœ¨</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <!-- VIEW 1: THIá»†P -->
  <section id="viewCard" class="view active">
    <div class="card-stage">
      <div class="card-wrap">
        <div class="spark"></div>
        <div id="card" class="card" title="Báº¥m Ä‘á»ƒ má»Ÿ thiá»‡p">
          <div class="card-face card-front">
            <!-- áº¢NH 1 (thiá»‡p) -->
            <img src="card.png" alt="Thiá»‡p chÃºc Táº¿t" />
          </div>
          <div class="card-face card-back">
            <div class="inside">
              <div>
                <h1>ChÃºc má»«ng nÄƒm má»›i ğŸŠ</h1>
                <p>Nháº¥n thÃªm 1 láº§n Ä‘á»ƒ bÆ°á»›c vÃ o khÃ´ng gian Táº¿t âœ¨</p>
                <div class="hint">ğŸ§§ Nháº¥n Ä‘á»ƒ má»Ÿ thiá»‡p</div>
                <p class="small" style="margin-top:10px;opacity:.75">
                  * Má»—i mÃ¡y chá»‰ má»Ÿ Ä‘Æ°á»£c 1 thiá»‡p lÃ¬ xÃ¬ trong trang chÃ­nh
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- VIEW 2: TRANG CHÃNH -->
  <section id="viewMain" class="view">
    <div class="main">
      <div class="scene">
        <!-- áº¢NH 2 (khung cáº£nh chá»§ Ä‘áº¡o) -->
        <img src="main.png" alt="KhÃ´ng gian Táº¿t" />
        <div class="vignette"></div>
        <div class="snow"></div>
      </div>

      <div class="topbar">
        <div id="statusBadge" class="badge">
          <span>ğŸ´</span>
          <span><b>Chá»n 1 thiá»‡p</b> trÃªn cÃ¢y Ä‘Ã o Ä‘á»ƒ má»Ÿ lá»i chÃºc</span>
        </div>
        
      </div>

      <div id="envelopes" class="envelopes"></div>

      <div class="petals"></div>
  </section>

  <!-- MODAL -->
  <div id="modal" class="modal" role="dialog" aria-modal="true">
    <div class="dialog">
      <div class="dialog-head">
        <h2 id="modalTitle">ğŸ§§ Thiá»‡p Táº¿t</h2>
        <button id="btnClose" class="btn">ÄÃ³ng</button>
      </div>
      <div class="dialog-body">
        <p id="wishText" class="wish"></p>

        <div id="media" class="media">
          <img id="mediaImg" alt="áº¢nh kÃ¨m theo" />
        </div>

        <p id="note" class="note"></p>

        <div class="row">
          <button id="btnOk" class="btn">OK âœ…</button>
        </div>
      </div>
    </div>
  </div>

<script>
/**
 * ====== Cáº¤U HÃŒNH THIá»†P (Báº¡n sá»­a á»Ÿ Ä‘Ã¢y) ======
 * - text: lá»i chÃºc
 * - image: (tuá»³ chá»n) Ä‘Æ°á»ng dáº«n áº£nh riÃªng báº¡n muá»‘n hiá»‡n khi báº¥m trÃºng thiá»‡p Ä‘Ã³
 */
const GIFTS = [
  { id: 1, text: "ChÃºc báº¡n nÄƒm má»›i bÃ¬nh an, gáº·p nhiá»u may máº¯n vÃ  luÃ´n ráº¡ng rá»¡ nhÆ° hoa Ä‘Ã o ná»Ÿ ğŸŒ¸", image: "gift1.jpg" },
  { id: 2, text: "NÄƒm má»›i phÃ¡t tÃ i phÃ¡t lá»™c, há»c Ä‘Ã¢u hiá»ƒu Ä‘Ã³, lÃ m Ä‘Ã¢u tháº¯ng Ä‘Ã³ ğŸ’¸", image: "gift2.jpg" },
  { id: 3, text: "ChÃºc má»i Ä‘iá»u thuáº­n lá»£i, niá»m vui Ä‘áº§y tÃºi, ná»—i buá»“n rÆ¡i máº¥t tiÃªu âœ¨", image: "gift3.jpg" },
  { id: 4, text: "ChÃºc báº¡n luÃ´n Ä‘Æ°á»£c yÃªu thÆ°Æ¡ng, Äƒn Táº¿t vui, cáº£ nÄƒm vui ğŸ‰", image: "gift4.jpg" },
  { id: 5, text: "ChÃºc sá»©c khá»e dá»“i dÃ o, tinh tháº§n máº¡nh máº½, má»¥c tiÃªu nÃ o cÅ©ng Ä‘áº¡t ğŸ’ª", image: "gift5.jpg" },
  { id: 6, text: "ChÃºc báº¡n cÃ³ má»™t nÄƒm má»›i Ä‘áº§y mÃ u sáº¯c, thÃ nh cÃ´ng vÃ  háº¡nh phÃºc ğŸŒˆ", image: "gift6.jpg" },
  { id: 7, text: "Mong báº¡n luÃ´n tÆ°Æ¡i cÆ°á»i, vÆ°á»£t qua má»i khÃ³ khÄƒn vÃ  Ä‘áº¡t Ä‘Æ°á»£c Æ°á»›c mÆ¡ ğŸ’«", image: "gift7.jpg" },
  { id: 8, text: "ChÃºc gia Ä‘Ã¬nh báº¡n luÃ´n áº¥m Ã¡p, hÃ²a thuáº­n vÃ  trÃ n ngáº­p tÃ¬nh yÃªu â¤ï¸", image: "gift8.jpg" },
  { id: 9, text: "NÄƒm má»›i, báº¡n sáº½ gáº·p nhá»¯ng Ä‘iá»u tuyá»‡t vá»i, hÃ£y luÃ´n cÆ°á»i tháº­t ráº¡ng rá»¡ nhÃ© ğŸ˜Š", image: "gift9.jpg" },
  { id: 10, text: "ChÃºc báº¡n nÄƒm má»›i thÃ nh cÃ´ng trong cÃ´ng viá»‡c, há»c táº­p vÃ  cuá»™c sá»‘ng ğŸ†", image: "gift10.jpg" },
];

/**
 * ====== Vá»‹ trÃ­ thiá»‡p trÃªn cÃ¢y (theo % mÃ n hÃ¬nh) ======
 * Báº¡n chá»‰nh láº¡i cho khá»›p cÃ¢y Ä‘Ã o trong áº£nh 2.
 */
const ENVELOPES_LAYOUT = [
  { x: 50.1, y: 11.6, r: 0 },
  { x: 43.5, y: 22.3, r: 0 },
  { x: 32.8, y: 33.0, r: 0 },
  { x: 29.4, y: 53.7, r: 0 },
  { x: 40.7, y: 37.9, r: 0 },
  { x: 33.6, y: 62.4, r: 0 },
  { x: 38.4, y: 57.6, r: 0 },
  { x: 39.3, y: 68.8, r: 0 },
  { x: 46.3, y: 64.8, r: 0 },
  { x: 49.7, y: 63.8, r: 0 },
  { x: 62.6, y: 59.8, r: 0 },
  { x: 55.7, y: 55.9, r: 0 },
  { x: 66.7, y: 62.4, r: 0 },
  { x: 73.4, y: 52.7, r: 0 },
  { x: 58.4, y: 43.0, r: 0 },
  { x: 64.0, y: 38.0, r: 0 },
  { x: 68.4, y: 41.6, r: 0 },
  { x: 63.9, y: 29.4, r: 0 },
  { x: 45.7, y: 33.4, r: 0 },
  { x: 42.0, y: 49.2, r: 0 },
  { x: 37.6, y: 38.3, r: 0 },
];

const STORAGE_KEY = "tet_opened_gift_v1";

/* ====== View Switch ====== */
const viewCard = document.getElementById("viewCard");
const viewMain = document.getElementById("viewMain");
const card = document.getElementById("card");

let openedCardOnce = false;

card.addEventListener("click", () => {
  if (openedCardOnce) return; // Prevent multiple clicks
  
  openedCardOnce = true;
  card.classList.add("open");
  
  // Sau animation xong, vÃ o trang chÃ­nh
  setTimeout(() => {
    goMain();
  }, 1200); // Match the card animation duration
});

function goMain(){
  viewCard.classList.remove("active");
  viewMain.classList.add("active");
  initMain();
  initPetals(); // Initialize random falling petals
}

function initPetals(){
  const petalsContainer = document.querySelector(".petals");
  if(!petalsContainer) return;
  
  petalsContainer.innerHTML = ""; // Clear existing petals
  
  // Create 25 petals with random properties
  for(let i = 0; i < 25; i++){
    const petal = document.createElement("div");
    petal.className = "petal";
    
    // Random position: left 0-100%, small height for variety
    const randomLeft = Math.random() * 100;
    const randomSize = 13 + Math.random() * 3; // 13-16px
    
    // Random timing: duration 10-16s, delay 0-0.5s
    const randomDuration = 10 + Math.random() * 6;
    const randomDelay = Math.random() * 0.5;
    
    petal.style.left = randomLeft + "%";
    petal.style.width = randomSize + "px";
    petal.style.height = randomSize + "px";
    petal.style.setProperty("--duration", randomDuration + "s");
    petal.style.setProperty("--delay", randomDelay + "s");
    
    petalsContainer.appendChild(petal);
  }
}

/* ====== Main ====== */
const envelopesEl = document.getElementById("envelopes");
const modal = document.getElementById("modal");
const wishText = document.getElementById("wishText");
const media = document.getElementById("media");
const mediaImg = document.getElementById("mediaImg");
const modalTitle = document.getElementById("modalTitle");
const noteEl = document.getElementById("note");
const statusBadge = document.getElementById("statusBadge");

const btnClose = document.getElementById("btnClose");
const btnOk = document.getElementById("btnOk");
const btnShare = document.getElementById("btnShare");
const btnResetHint = document.getElementById("btnResetHint");

btnClose.onclick = closeModal;
btnOk.onclick = closeModal;
modal.addEventListener("click", (e)=>{ if(e.target === modal) closeModal(); });

btnShare.onclick = async () => {
  const url = location.href;
  try{
    if (navigator.share) {
      await navigator.share({ title: document.title, url });
    } else {
      await navigator.clipboard.writeText(url);
      toast("ÄÃ£ copy link Ä‘á»ƒ chia sáº» âœ…");
    }
  }catch(err){
    // user cancel share -> ignore
  }
};

btnResetHint.onclick = () => {
  // â€œHá»— trá»£â€ nháº¹: chá»‰ hÆ°á»›ng dáº«n náº¿u Ä‘Ã£ bá»‹ khÃ³a
  const opened = localStorage.getItem(STORAGE_KEY);
  if(opened){
    alert(
`Thiáº¿t bá»‹ nÃ y Ä‘Ã£ má»Ÿ 1 thiá»‡p (Ä‘Ã£ khÃ³a theo yÃªu cáº§u).
Náº¿u báº¡n lÃ  chá»§ web vÃ  muá»‘n test láº¡i:
- Má»Ÿ DevTools (F12) > Application > Local Storage
- XÃ³a key: ${STORAGE_KEY}
Hoáº·c cháº¡y lá»‡nh: localStorage.removeItem("${STORAGE_KEY}")`
    );
  } else {
    alert("MÃ¡y nÃ y chÆ°a má»Ÿ thiá»‡p nÃ o. Báº¡n cÃ³ thá»ƒ báº¥m 1 thiá»‡p trÃªn cÃ¢y Ä‘Ã o nhÃ©!");
  }
};

function initMain(){
  envelopesEl.innerHTML = "";

  const opened = getOpenedGift();
  if(opened){
    statusBadge.innerHTML = ``;
  } else {
    statusBadge.innerHTML = `<span>ğŸ´</span><span><b>Chá»n 1 thiá»‡p</b> trÃªn cÃ¢y Ä‘Ã o Ä‘á»ƒ má»Ÿ lá»i chÃºc</span>`;
  }

  ENVELOPES_LAYOUT.forEach((pos, idx) => {
    const el = document.createElement("button");
    el.className = "env";
    el.style.left = pos.x + "%";
    el.style.top  = pos.y + "%";
    el.style.setProperty("--r", (pos.r || 0) + "deg");
    el.title = "Báº¥m Ä‘á»ƒ má»Ÿ";

    // Náº¿u Ä‘Ã£ má»Ÿ 1 thiá»‡p -> khÃ³a háº¿t
    if(opened){
      el.classList.add("locked");
      el.disabled = true;
      el.title = "Báº¡n Ä‘Ã£ má»Ÿ 1 thiá»‡p rá»“i";
    }

    el.addEventListener("click", () => {
      if(getOpenedGift()){
        toast("Thiáº¿t bá»‹ nÃ y Ä‘Ã£ má»Ÿ 1 thiá»‡p rá»“i ğŸ”’");
        return;
      }
      // Chá»n ngáº«u nhiÃªn 1 gift (hoáº·c báº¡n cÃ³ thá»ƒ map idx->gift náº¿u muá»‘n cá»‘ Ä‘á»‹nh)
      const gift = GIFTS[Math.floor(Math.random() * GIFTS.length)];
      setOpenedGift(gift);
      showGift(gift);
      lockAllEnvelopes();
      statusBadge.innerHTML = ``;
    });

    envelopesEl.appendChild(el);
  });
}

function lockAllEnvelopes(){
  document.querySelectorAll(".env").forEach(btn=>{
    btn.classList.add("locked");
    btn.disabled = true;
    btn.title = "Báº¡n Ä‘Ã£ má»Ÿ 1 thiá»‡p rá»“i";
  });
}

function showGift(gift){
  modalTitle.textContent = "ğŸ§§ Thiá»‡p Táº¿t #" + gift.id;
  wishText.textContent = gift.text;

  if(gift.image){
    media.style.display = "block";
    mediaImg.src = gift.image;
  } else {
    media.style.display = "none";
    mediaImg.removeAttribute("src");
  }

  noteEl.textContent = "";

  modal.classList.add("show");
}

function closeModal(){
  modal.classList.remove("show");
}

/* ====== Anti-fraud (device only once) ======
 * CÃ¡ch nÃ y dá»±a trÃªn localStorage => Ä‘Ãºng yÃªu cáº§u â€œmá»—i mÃ¡yâ€ á»Ÿ má»©c phá»• thÃ´ng.
 * Ai rÃ nh xÃ³a dá»¯ liá»‡u váº«n lÃ¡ch Ä‘Æ°á»£c. Muá»‘n khÃ³a cá»©ng hÆ¡n -> xem pháº§n backend bÃªn dÆ°á»›i.
 */
function setOpenedGift(gift){
  localStorage.setItem(STORAGE_KEY, JSON.stringify({
    openedAt: Date.now(),
    giftId: gift.id
  }));
}
function getOpenedGift(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw) return null;
    return JSON.parse(raw);
  }catch{
    return null;
  }
}

/* Tiny toast */
let toastTimer = null;
function toast(msg){
  let el = document.getElementById("toast");
  if(!el){
    el = document.createElement("div");
    el.id = "toast";
    el.style.position="fixed";
    el.style.left="50%";
    el.style.bottom="22px";
    el.style.transform="translateX(-50%)";
    el.style.padding="10px 12px";
    el.style.borderRadius="999px";
    el.style.background="rgba(0,0,0,.55)";
    el.style.border="1px solid rgba(255,255,255,.16)";
    el.style.backdropFilter="blur(10px)";
    el.style.boxShadow="0 18px 40px rgba(0,0,0,.35)";
    el.style.fontSize="13px";
    el.style.opacity="0";
    el.style.transition="opacity .2s ease, transform .2s ease";
    el.style.zIndex="9999";
    document.body.appendChild(el);
  }
  el.textContent = msg;
  el.style.opacity="1";
  el.style.transform="translateX(-50%) translateY(-2px)";
  clearTimeout(toastTimer);
  toastTimer = setTimeout(()=>{
    el.style.opacity="0";
    el.style.transform="translateX(-50%) translateY(0px)";
  }, 1600);
}
</script>
</body>
</html>
